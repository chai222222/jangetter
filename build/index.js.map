{"version":3,"sources":["../src/index.js"],"names":["process","on","console","dir","argv","option","name","short","type","description","args","run","targets","length","help","exit","outputCsv","options","output","words","puppeteer","launch","ignoreHTTPSErrors","headless","browser","newPage","page","log","frm","url","setViewport","width","height","aeon","AeonSearch","janSearch","catch","e","stack","result","fields","json2csvParser","Json2csvParser","csv","parse","sjCsv","iconv","encode","fs","writeFile","err","close"],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;AACA;;;;;;;;2cAP0B;;;AAS1BA,QAAQC,EAAR,CAAW,oBAAX,EAAiCC,QAAQC,GAAzC;;AAEAC,eAAKC,MAAL,CAAY;AACRC,QAAM,QADE;AAERC,SAAO,GAFC;AAGRC,QAAM,MAHE;AAIRC,eAAa;AAJL,CAAZ;AAMA,IAAMC,OAAON,eAAKO,GAAL,EAAb;;AAEA,IAAID,KAAKE,OAAL,CAAaC,MAAb,GAAsB,CAA1B,EAA6B;AAC3BT,iBAAKU,IAAL;AACAd,UAAQe,IAAR,CAAa,CAAb;AACD;;AAED,IAAMC,YAAYN,KAAKO,OAAL,CAAaC,MAAb,IAAuB,SAAzC;;AAEA;AAAA,qEAAC,iBAAOC,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACuBC,oBAAUC,MAAV,CAAiB;AACrCC,iCAAmB,IADkB;AAErCC,wBAAU,IAF2B;AAGrCb,oBAAM,CACJ,kCADI,EAEJ,kBAFI,EAGJ,cAHI,EAIJ,OAJI;AAH+B,aAAjB,CADvB;;AAAA;AACOc,mBADP;AAAA;AAAA;AAAA,mBAasBA,QAAQC,OAAR,EAbtB;;AAAA;AAaSC,gBAbT;AAAA;AAAA,mBAcSA,KAAKzB,EAAL,CAAQ,gBAAR,EAA0B,eAAO;AACrCC,sBAAQyB,GAAR,CAAY,UAAZ,EAAwBC,IAAIC,GAAJ,EAAxB;AACD,aAFK,CAdT;;AAAA;AAAA;AAAA,mBAiBSH,KAAKI,WAAL,CAAiB,EAAEC,OAAO,IAAT,EAAeC,QAAQ,IAAvB,EAAjB,CAjBT;;AAAA;;AAmBG;AACMC,gBApBT,GAoBgB,IAAIC,cAAJ,CAAeR,IAAf,CApBhB;AAAA;AAAA,mBAqBwBO,KAAKE,SAAL,gCAAkBhB,KAAlB,GAAyBiB,KAAzB,CAA+B,aAAK;AACvDlC,sBAAQyB,GAAR,CAAYU,EAAEC,KAAd;AACD,aAFoB,CArBxB;;AAAA;AAqBSC,kBArBT;;;AAyBG;AACMC,kBA1BT,GA0BkB,CAAC,KAAD,EAAQ,OAAR,EAAiB,UAAjB,CA1BlB;AA2BSC,0BA3BT,GA2B0B,IAAIC,gBAAJ,CAAmB,EAACF,cAAD,EAAnB,CA3B1B;AA4BSG,eA5BT,GA4BeF,eAAeG,KAAf,CAAqBL,MAArB,CA5Bf;AA6BSM,iBA7BT,GA6BiBC,oBAAMC,MAAN,CAAaJ,GAAb,EAAkB,WAAlB,CA7BjB;;;AA+BGK,yBAAGC,SAAH,CAAajC,SAAb,EAAwB6B,KAAxB,EAA+B,UAACK,GAAD,EAAS;AACtC,kBAAIA,GAAJ,EAAS;AACL,sBAAMA,GAAN;AACH;AACF,aAJD;AAKAhD,oBAAQyB,GAAR,oBAA6BX,SAA7B;AApCH;AAAA;;AAAA;AAAA;AAAA;;AAsCGd,oBAAQyB,GAAR,CAAY,YAAEW,KAAd;;AAtCH;AAAA;;AAwCGpC,oBAAQyB,GAAR,CAAY,SAAZ;AACAH,oBAAQ2B,KAAR;AAzCH;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD;;AAAA;AAAA;AAAA;AAAA,KA2CGzC,KAAKE,OA3CR","file":"index.js","sourcesContent":["import 'babel-polyfill';  // eslint-disable-line import/no-extraneous-dependencies\nimport fs from 'fs';\nimport argv from 'argv';\nimport puppeteer from 'puppeteer';\nimport iconv from 'iconv-lite';\n\nimport { Parser as Json2csvParser } from 'json2csv';\nimport AeonSearch from './site/aeon'\n\nprocess.on('unhandledRejection', console.dir);\n\nargv.option({\n    name: 'output',\n    short: 'o',\n    type: 'path',\n    description: 'output csv file path.',\n});\nconst args = argv.run();\n\nif (args.targets.length < 1) {\n  argv.help();\n  process.exit(0);\n}\n\nconst outputCsv = args.options.output || 'jan.csv';\n\n(async (words) => {\n  const browser = await puppeteer.launch({\n    ignoreHTTPSErrors: true,\n    headless: true,\n    args: [\n      '--enable-features=NetworkService',\n      '--enable-logging',\n      '--no-sandbox',\n      '--v=1',\n      // `--proxy-server=${config.proxyUrl}`,\n    ],\n  });\n  try {\n    const page = await browser.newPage();\n    await page.on('framenavigated', frm => {\n      console.log(\"### URL \", frm.url());\n    });\n    await page.setViewport({ width: 1600, height: 1200 });\n\n    // AEONから検索\n    const aeon = new AeonSearch(page);\n    const result = await aeon.janSearch(...words).catch(e => {\n      console.log(e.stack);\n    });\n\n    // 結果をCSV(ShiftJIS)にして保存\n    const fields = ['jan', 'title', 'category'];\n    const json2csvParser = new Json2csvParser({fields});\n    const csv = json2csvParser.parse(result);\n    const sjCsv = iconv.encode(csv, \"Shift_JIS\");\n\n    fs.writeFile(outputCsv, sjCsv, (err) => {\n      if (err) {\n          throw err;\n      }\n    });\n    console.log(`Output done. [${outputCsv}]`);\n  } catch (e) {\n    console.log(e.stack);\n  } finally {\n    console.log('finally');\n    browser.close();\n  }\n})(args.targets);\n"]}