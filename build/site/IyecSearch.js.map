{"version":3,"sources":["../../src/site/IyecSearch.js"],"names":["IYEC_CONSTANTS","zip","searchConfig","prefix","top","lastSupportedDate","searchPageSelectors","productsLink","productsPageWaiter","productsPageCounter","nextLink","searchText","searchButton","productPageSelectors","jan","title","productPageImages","downloader","productPageImageSelectors","picture","replacer","pattern","value","category","IyecSearch","JanSearchBase","init","config","count","loginButton","existsAll","console","log","page","click","waitLoaded","toTop","xselectLink","needInputShop","SEL_ZIP","SEL_ZIP_SRC","type","waitFor","searchWord","Error","getSrcConfig"],"mappings":"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","sourcesContent":["import JanSearchBase from './JanSearchBase';\nimport { REPLACERS } from '../util/Replacer';\n\nconst IYEC_CONSTANTS = {\n  zip: '2140038',\n  searchConfig: {\n    prefix: 'Iyec',\n    top: 'https://www.iy-net.jp/',\n    lastSupportedDate: '2022/06/02: 17:00:00(暫定 --debug-window 必須)',\n    searchPageSelectors: {\n      productsLink: 'div.Presenter__ProductImgGroup-sc-ip6p2i-1 > a',\n      productsPageWaiter: [ 'div.SearchProduct__PageTitleWrapper-sc-1yd8y9g-2' ],\n      productsPageCounter: 'div.PageInfo__Wrapper-sc-1kvc99-0 p:nth-child(2)',\n      nextLink: '//button[contains(text(), \"次のページへ\")]',\n      searchText: 'input[name=\"searchWord\"]',\n      searchButton: 'header button',\n    },\n    productPageSelectors: {\n      jan: 'url',\n      // category: 'ol.breadcrumb',\n      title: 'p.ProductNameArea__ProductNameText-sc-11k1ztn-2',\n    },\n    productPageImages: {\n      downloader: 'puppeteer',\n    },\n    productPageImageSelectors: {\n      picture: 'div.Items__MainContent-sc-1fzjknj-0 img', // 複数マッチする\n    },\n    replacer: {\n      jan: [{\n        pattern: /^.*\\/(\\d+)\\/$/,\n        value: '$1',\n      }],\n      category: [{\n        pattern: /\\s+/g,\n        value: ' ',\n      }],\n    },\n  },\n};\n\nexport default class IyecSearch extends JanSearchBase {\n  static SEL_ZIP = 'input[name=\"postalNumber\"]';\n  static SEL_ZIP_SRC = 'button[data-testid=\"post-number-search-button\"]';\n\n  /**\n   * 検索可能画面になるまで遷移する。\n   */\n  async init() {\n    const config = IYEC_CONSTANTS.searchConfig;\n    let count = 10;\n    while (count-- > 0) {\n      // await this.page.screenshot({ path: `./fullpage_${count}.png`, fullPage: true });\n      // LOGOUT画面確認\n      const loginButton = await this.existsAll('button.link-btn');\n      if (loginButton) {\n        console.log('LOGOUT → TOP画面');\n        await this.page.click('header.st-header a');\n        await this.waitLoaded();\n        continue;\n      }\n      const toTop = '//button[contains(text(), \"トップページへ戻る\")]';\n      if (toTop && toTop > 0) {\n        console.log('SYSERR → TOP画面');\n        await this.xselectLink(toTop[0])\n        await this.waitLoaded();\n        continue;\n      }\n      const needInputShop = await this.existsAll(IyecSearch.SEL_ZIP, IyecSearch.SEL_ZIP_SRC);\n      if (needInputShop) {\n        console.log('ZIP入力');\n        await this.page.type(IyecSearch.SEL_ZIP, IYEC_CONSTANTS.zip);\n        await this.page.waitFor(1000);\n        await this.page.click(IyecSearch.SEL_ZIP_SRC)\n        await this.page.waitFor(5000);\n        await this.waitLoaded();\n        continue;\n      }\n      const searchWord = await this.existsAll(config.searchPageSelectors.searchText);\n      if (!searchWord) {\n        console.log('検索準備', count);\n        if (count) {\n          await this.page.waitFor(5000);\n          continue;\n        } else {\n          throw new Error('検索準備ができませんでした');\n        }\n      } else {\n        count = 0;\n      }\n    }\n    // await this.page.screenshot({ path: './fullpage_inited.png', fullPage: true });\n  }\n\n  getSrcConfig() {\n    return IYEC_CONSTANTS.searchConfig;\n  }\n}\n"],"file":"IyecSearch.js"}